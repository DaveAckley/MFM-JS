!function(t){var e={};function o(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(r,i,function(e){return t[e]}.bind(null,i));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);class r{constructor(t,e,o=100,r=100){this.name=t,this.type=e,this.moveability=o,this.killability=r}exec(t){}}class i{constructor(t=s.EMPTY){this.type=t,this.elem=new this.type.class}exec(t){this.elem.exec(t)}}class s{static registerType(t,e,o){this.TYPES_ARRAY.push({name:t,type:e,class:o})}}s.EMPTY={name:"EMPTY",type:"E",class:class extends r{constructor(){super(s.EMPTY.name,s.EMPTY.type)}exec(t){super.exec(t)}}},s.DREG={name:"DREG",type:"D",class:class extends r{constructor(){super(s.DREG.name,s.DREG.type),this.pTOTAL_CHANCE=100,this.pDREG_CREATE=.1,this.pRES_CREATE=.5,this.pDREG_DESTROY=10,this.pANY_DESTROY=1}exec(t){const e=t.getAdjacent4Way();if(e.atom.type===s.EMPTY){const o=Math.random()*this.pTOTAL_CHANCE<this.pDREG_CREATE,r=Math.random()*this.pTOTAL_CHANCE<this.pRES_CREATE;o?(t.origin.moveAtom(e,new i(s.DREG)),console.log("DREG CREATED")):r?(t.origin.moveAtom(e,new i(s.RES)),console.log("RES CREATED")):t.origin.swapAtoms(e)}else e.atom.type===s.DREG?Math.random()*this.pTOTAL_CHANCE<this.pDREG_DESTROY&&(console.log("DREG DESTROYED"),t.origin.moveAtom(e)):Math.random()*this.pTOTAL_CHANCE<this.pANY_DESTROY&&(console.log(e.atom.type.name+" DESTROYED"),t.origin.moveAtom(e));super.exec(t)}}},s.RES={name:"RES",type:"R",class:class extends r{constructor(){super(s.RES.name,s.RES.type)}exec(t){t.origin.swapAtoms(t.getRandom(s.EMPTY)),super.exec(t)}}},s.WALL={name:"WALL",type:"W",class:class extends r{constructor(){super(s.WALL.name,s.WALL.type,0,0)}exec(t){super.exec(t)}}},s.TYPES_ARRAY=[s.EMPTY,s.DREG,s.RES,s.WALL];class n{constructor(t,e){this.tile=t,this.makeWindow(t,e)}makeWindow(t,e){if(this.window=new Map,this.origin=this.tile.getSiteByCoord(e),this.origin.atom.type===s.EMPTY)return;this.window.set(this.origin.id,this.origin),n.WINDOW_ORDER_OFFSETS.map(t=>this.OffsetFromOrigin(e,t.row,t.col)).forEach(e=>{let o=t.getSiteByCoord(e);o&&this.window.set(o.id,o)})}OffsetFromOrigin(t,e,o){return{row:t.row+e,col:t.col+o}}getRandom(t){return this.getSiteFromCandidates(Array.from(this.window.values()),!0,t)}getNearest(t){return this.getSiteFromCandidates(Array.from(this.window.values()),!1,t)}getEast(){return this.getDirection(n.EW_EAST)}getWest(){return this.getDirection(n.EW_WEST)}getNorth(){return this.getDirection(n.EW_NORTH)}getSouth(){return this.getDirection(n.EW_SOUTH)}getNorthWest(){return this.getDirection(n.EW_NORTHWEST)}getSouthWest(){return this.getDirection(n.EW_SOUTHWEST)}getNorthEast(){return this.getDirection(n.EW_NORTHEAST)}getSouthEast(){return this.getDirection(n.EW_SOUTHEAST)}getAdjacent4Way(t=!0,e){return this.getSiteFromCandidates([this.getWest(),this.getNorth(),this.getSouth(),this.getEast()],t,e)}getAdjacent8Way(t=!0,e){return this.getSiteFromCandidates([this.getWest(),this.getNorth(),this.getSouth(),this.getEast(),this.getNorthWest(),this.getSouthWest(),this.getNorthEast(),this.getSouthEast()],t,e)}getSiteFromCandidates(t,e=!0,o){if(!((t=t.filter(t=>!!t&&(o?!(!o||t.atom.type!==o)&&t:t))).length<1))return e?t[Math.floor(Math.random()*t.length)]:t[0]}getDirection(t){let e=this.tile.sites.get(a.CtoID(this.OffsetFromOrigin(this.origin.tilePos,t.row,t.col)));if(e)return e}}n.WINDOW_ORDER_OFFSETS=[{col:0,row:0},{col:-1,row:0},{col:0,row:-1},{col:0,row:1},{col:1,row:0},{col:-1,row:-1},{col:-1,row:1},{col:1,row:-1},{col:1,row:1},{col:-2,row:0},{col:0,row:-1},{col:0,row:2},{col:2,row:0},{col:-2,row:-1},{col:-2,row:1},{col:-1,row:-2},{col:-1,row:2},{col:1,row:-2},{col:1,row:2},{col:2,row:-1},{col:2,row:1},{col:-3,row:0},{col:0,row:-3},{col:0,row:3},{col:3,row:0},{col:-2,row:-2},{col:-2,row:2},{col:2,row:-2},{col:2,row:2},{col:-3,row:-1},{col:-3,row:1},{col:-1,row:-3},{col:-1,row:3},{col:1,row:-3},{col:1,row:3},{col:3,row:-1},{col:3,row:1},{col:-4,row:0},{col:0,row:-4},{col:0,row:4},{col:4,row:0}],n.EW_WEST={col:-1,row:0},n.EW_EAST={col:1,row:0},n.EW_NORTH={col:0,row:-1},n.EW_SOUTH={col:0,row:1},n.EW_NORTHWEST={col:-1,row:-1},n.EW_SOUTHWEST={col:-1,row:1},n.EW_NORTHEAST={col:1,row:-1},n.EW_SOUTHEAST={col:1,row:1};class a{static CtoID(t){return`${t.row}:${t.col}`}static IDtoC(t){let e=t.split(":");return{row:parseInt(e[0]),col:parseInt(e[1])}}static GenerateEventWindow(t,e,o){let r=Math.floor(Math.random()*e),i=Math.floor(Math.random()*o);return new n(t,{row:i,col:r})}}class l{constructor(t){this.tilePos=t,this.id=a.CtoID(this.tilePos),this.create()}killAtom(t){100*Math.random()<t.atom.elem.killability&&(t.atom=new i(s.EMPTY))}moveAtom(t,e=new i(s.EMPTY)){if(t){100*Math.random()<t.atom.elem.killability&&([this.atom,t.atom]=[e,this.atom])}}swapAtoms(t){if(t){100*Math.random()<t.atom.elem.moveability&&([this.atom,t.atom]=[t.atom,this.atom])}}create(){this.atom=new i}}let c=new class{constructor(t=1,e=1){this.width=t,this.height=e,this.create()}getSiteByCoord(t){return this.sites.get(a.CtoID(t))}getRandomSite(){let t=Math.floor(Math.random()*this.height),e=Math.floor(Math.random()*this.width);return this.sites.get(`${t}:${e}`)}create(){this.sites=new Map;for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)this.sites.set(`${e}:${t}`,new l({row:e,col:t}))}}(32,32);new p5(t=>{t.preload=(()=>{}),t.setup=(()=>{t.createCanvas(700,700)});t.draw=(()=>{t.background(100),((t,e)=>{t.push(),t.translate(25,25),e.sites.forEach(e=>{switch(e.atom.elem.type){case s.EMPTY.type:t.stroke(0,0,0,0),t.fill(32,32,32,127);break;case s.DREG.type:t.stroke(0,0,0,127),t.fill(255,32,32);break;case s.RES.type:t.stroke(0,0,0,127),t.fill(32,255,64);break;case s.WALL.type:t.stroke(0,0,0,127),t.fill(32,32,255)}t.ellipse(14*e.tilePos.col,14*e.tilePos.row,14,14)}),t.pop()})(t,c),(()=>{for(var t=0;t<1e3;t++){let t=a.GenerateEventWindow(c,c.width,c.height);t.origin.atom.exec(t)}})()}),t.mouseClicked=(()=>{let e=((t,e)=>(t=t-25+7,e=e-25+7,t=Math.floor(t/14),e=Math.floor(e/14),c.getSiteByCoord({row:e,col:t})))(t.mouseX,t.mouseY);e&&(t.keyIsPressed?e.atom=new i(s.WALL):e.atom=new i(s.DREG))})})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL21mbS9jbGFzc2VzL0VsZW0udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21mbS9jbGFzc2VzL0F0b20udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21mbS9jbGFzc2VzL0VsZW1lbnRUeXBlcy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWZtL2NsYXNzZXMvZWxlbWVudHMvRW1wdHlFbGVtZW50LnRzIiwid2VicGFjazovLy8uL3NyYy9tZm0vY2xhc3Nlcy9lbGVtZW50cy9EUmVnRWxlbWVudC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWZtL2NsYXNzZXMvZWxlbWVudHMvUmVzRWxlbWVudC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWZtL2NsYXNzZXMvZWxlbWVudHMvV2FsbEVsZW1lbnQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21mbS9jbGFzc2VzL0V2ZW50d2luZG93LnRzIiwid2VicGFjazovLy8uL3NyYy9tZm0vdXRpbHMvdXRpbHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21mbS9jbGFzc2VzL1NpdGUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy9tZm0vY2xhc3Nlcy9UaWxlLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiRWxlbSIsIltvYmplY3QgT2JqZWN0XSIsIl9uYW1lIiwiX3R5cGUiLCJfbW92ZWFiaWxpdHkiLCJfa2lsbGFiaWxpdHkiLCJ0aGlzIiwidHlwZSIsIm1vdmVhYmlsaXR5Iiwia2lsbGFiaWxpdHkiLCJldyIsIkF0b21fQXRvbSIsIkVsZW1lbnRUeXBlcyIsIkVNUFRZIiwiZWxlbSIsImNsYXNzIiwiZXhlYyIsIlRZUEVTX0FSUkFZIiwicHVzaCIsInN1cGVyIiwiRFJFRyIsInBUT1RBTF9DSEFOQ0UiLCJwRFJFR19DUkVBVEUiLCJwUkVTX0NSRUFURSIsInBEUkVHX0RFU1RST1kiLCJwQU5ZX0RFU1RST1kiLCJhdmFpbGFibGVTaXRlIiwiZ2V0QWRqYWNlbnQ0V2F5IiwiYXRvbSIsImNyZWF0ZURSZWciLCJNYXRoIiwicmFuZG9tIiwiY3JlYXRlUmVzIiwib3JpZ2luIiwibW92ZUF0b20iLCJjb25zb2xlIiwibG9nIiwiUkVTIiwic3dhcEF0b21zIiwiZ2V0UmFuZG9tIiwiV0FMTCIsIkV2ZW50d2luZG93X0V2ZW50V2luZG93IiwiX3RpbGUiLCJfb3JpZ2luIiwidGlsZSIsIm1ha2VXaW5kb3ciLCJ3aW5kb3ciLCJNYXAiLCJnZXRTaXRlQnlDb29yZCIsInNldCIsImlkIiwiV0lORE9XX09SREVSX09GRlNFVFMiLCJtYXAiLCJvZmZzZXQiLCJPZmZzZXRGcm9tT3JpZ2luIiwicm93IiwiY29sIiwiZm9yRWFjaCIsInRpbGVDb29yZCIsInNpdGUiLCJyb3dPZmZzZXQiLCJjb2xPZmZzZXQiLCJzcGVjaWZpY1R5cGUiLCJnZXRTaXRlRnJvbUNhbmRpZGF0ZXMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJnZXREaXJlY3Rpb24iLCJFV19FQVNUIiwiRVdfV0VTVCIsIkVXX05PUlRIIiwiRVdfU09VVEgiLCJFV19OT1JUSFdFU1QiLCJFV19TT1VUSFdFU1QiLCJFV19OT1JUSEVBU1QiLCJFV19TT1VUSEVBU1QiLCJyYW5kb21pemUiLCJnZXRXZXN0IiwiZ2V0Tm9ydGgiLCJnZXRTb3V0aCIsImdldEVhc3QiLCJnZXROb3J0aFdlc3QiLCJnZXRTb3V0aFdlc3QiLCJnZXROb3J0aEVhc3QiLCJnZXRTb3V0aEVhc3QiLCJjYW5kaWRhdGVTaXRlcyIsImZpbHRlciIsImxlbmd0aCIsImZsb29yIiwiZGlyZWN0aW9uIiwic2l0ZXMiLCJ1dGlsc19NRk1VdGlscyIsIkN0b0lEIiwidGlsZVBvcyIsInJjYSIsInNwbGl0IiwicGFyc2VJbnQiLCJ3IiwiaCIsInJjIiwicnIiLCJTaXRlX1NpdGUiLCJfcG9zIiwidGFyZ2V0U2l0ZSIsImxlYXZpbmdBdG9tIiwiZyIsIl93aWR0aCIsIl9oZWlnaHQiLCJ3aWR0aCIsImhlaWdodCIsImoiLCJwNSIsInByZWxvYWQiLCJzZXR1cCIsImNyZWF0ZUNhbnZhcyIsImRyYXciLCJiYWNrZ3JvdW5kIiwidHJhbnNsYXRlIiwic3Ryb2tlIiwiZmlsbCIsImVsbGlwc2UiLCJwb3AiLCJkcmF3R3JpZCIsIkdlbmVyYXRlRXZlbnRXaW5kb3ciLCJydW4iLCJtb3VzZUNsaWNrZWQiLCJ4IiwieSIsInNpdGVTaXplIiwiZ2V0U2l0ZUZyb21DYW52YXNYWSIsIm1vdXNlWCIsIm1vdXNlWSIsImtleUlzUHJlc3NlZCJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQTBDSyxZQUFBLEVBQUFDLElB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RHZCLElBQ2tDQSxJQUFBLENBQ2xDLElBQUEwQyxFQUFxQmlGLEVBQVFnQyxvQkFBQWxCLElBQUFHLE1BQUFILEVBQUFJLFFBQzdCbkcsRUFBQXVCLE9BQUFMLEtBQUFaLEtBQUFOLEtBYUFrSCxLQUVBOUgsRUFBQStILGFBQUEsTUFDQSxJQUFBbEUsRUFiQSxFQUFBbUUsRUFBQUMsS0FDQUQsSUExQ0EsR0EwQ0FFLEVBQ0FELElBM0NBLEdBMkNBQyxFQUNBRixFQUFBaEcsS0FBQTBELE1BQUFzQyxFQTdDQSxJQThDQUMsRUFBQWpHLEtBQUEwRCxNQUFBdUMsRUE5Q0EsSUErQ0F0QixFQUFBekQsZ0JBQWlDTyxJQUFBd0UsRUFBQXZFLElBQUFzRSxLQVFqQ0csQ0FBQW5JLEVBQUFvSSxPQUFBcEksRUFBQXFJLFFBQ0F4RSxJQUNBN0QsRUFBQXNJLGFBQ0F6RSxFQUFBL0IsS0FBQSxJQUFnQ2pCLEVBQUtDLEVBQVk0QixNQUdqRG1CLEVBQUEvQixLQUFBLElBQWdDakIsRUFBS0MsRUFBWVEiLCJmaWxlIjoibWZtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGNsYXNzIEVsZW0ge1xuICAgIGNvbnN0cnVjdG9yKF9uYW1lLCBfdHlwZSwgX21vdmVhYmlsaXR5ID0gMTAwLCBfa2lsbGFiaWxpdHkgPSAxMDApIHtcbiAgICAgICAgdGhpcy5uYW1lID0gX25hbWU7XG4gICAgICAgIHRoaXMudHlwZSA9IF90eXBlO1xuICAgICAgICB0aGlzLm1vdmVhYmlsaXR5ID0gX21vdmVhYmlsaXR5O1xuICAgICAgICB0aGlzLmtpbGxhYmlsaXR5ID0gX2tpbGxhYmlsaXR5O1xuICAgIH1cbiAgICBleGVjKGV3KSB7IH1cbn1cbiIsImltcG9ydCB7IEVsZW1lbnRUeXBlcyB9IGZyb20gXCIuL0VsZW1lbnRUeXBlc1wiO1xuZXhwb3J0IGNsYXNzIEF0b20ge1xuICAgIGNvbnN0cnVjdG9yKF90eXBlID0gRWxlbWVudFR5cGVzLkVNUFRZKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IF90eXBlO1xuICAgICAgICB0aGlzLmVsZW0gPSBuZXcgdGhpcy50eXBlLmNsYXNzKCk7XG4gICAgfVxuICAgIGV4ZWMoZXcpIHtcbiAgICAgICAgdGhpcy5lbGVtLmV4ZWMoZXcpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEVtcHR5RWxlbWVudCB9IGZyb20gXCIuL2VsZW1lbnRzL0VtcHR5RWxlbWVudFwiO1xuaW1wb3J0IHsgRFJlZ0VsZW1lbnQgfSBmcm9tIFwiLi9lbGVtZW50cy9EUmVnRWxlbWVudFwiO1xuaW1wb3J0IHsgUmVzRWxlbWVudCB9IGZyb20gXCIuL2VsZW1lbnRzL1Jlc0VsZW1lbnRcIjtcbmltcG9ydCB7IFdhbGxFbGVtZW50IH0gZnJvbSBcIi4vZWxlbWVudHMvV2FsbEVsZW1lbnRcIjtcbmV4cG9ydCBjbGFzcyBFbGVtZW50VHlwZXMge1xuICAgIHN0YXRpYyByZWdpc3RlclR5cGUobmFtZSwgdHlwZSwgYykge1xuICAgICAgICB0aGlzLlRZUEVTX0FSUkFZLnB1c2goeyBuYW1lLCB0eXBlLCBjbGFzczogYyB9KTtcbiAgICB9XG59XG5FbGVtZW50VHlwZXMuRU1QVFkgPSB7IG5hbWU6IFwiRU1QVFlcIiwgdHlwZTogXCJFXCIsIGNsYXNzOiBFbXB0eUVsZW1lbnQgfTtcbkVsZW1lbnRUeXBlcy5EUkVHID0geyBuYW1lOiBcIkRSRUdcIiwgdHlwZTogXCJEXCIsIGNsYXNzOiBEUmVnRWxlbWVudCB9O1xuRWxlbWVudFR5cGVzLlJFUyA9IHsgbmFtZTogXCJSRVNcIiwgdHlwZTogXCJSXCIsIGNsYXNzOiBSZXNFbGVtZW50IH07XG5FbGVtZW50VHlwZXMuV0FMTCA9IHsgbmFtZTogXCJXQUxMXCIsIHR5cGU6IFwiV1wiLCBjbGFzczogV2FsbEVsZW1lbnQgfTtcbkVsZW1lbnRUeXBlcy5UWVBFU19BUlJBWSA9IFtcbiAgICBFbGVtZW50VHlwZXMuRU1QVFksXG4gICAgRWxlbWVudFR5cGVzLkRSRUcsXG4gICAgRWxlbWVudFR5cGVzLlJFUyxcbiAgICBFbGVtZW50VHlwZXMuV0FMTFxuXTtcbiIsImltcG9ydCB7IEVsZW0gfSBmcm9tIFwiLi4vRWxlbVwiO1xuaW1wb3J0IHsgRWxlbWVudFR5cGVzIH0gZnJvbSBcIi4uL0VsZW1lbnRUeXBlc1wiO1xuZXhwb3J0IGNsYXNzIEVtcHR5RWxlbWVudCBleHRlbmRzIEVsZW0ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihFbGVtZW50VHlwZXMuRU1QVFkubmFtZSwgRWxlbWVudFR5cGVzLkVNUFRZLnR5cGUpO1xuICAgIH1cbiAgICBleGVjKGV3KSB7XG4gICAgICAgIHN1cGVyLmV4ZWMoZXcpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEVsZW0gfSBmcm9tIFwiLi4vRWxlbVwiO1xuaW1wb3J0IHsgRWxlbWVudFR5cGVzIH0gZnJvbSBcIi4uL0VsZW1lbnRUeXBlc1wiO1xuaW1wb3J0IHsgQXRvbSB9IGZyb20gXCIuLi9BdG9tXCI7XG5leHBvcnQgY2xhc3MgRFJlZ0VsZW1lbnQgZXh0ZW5kcyBFbGVtIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoRWxlbWVudFR5cGVzLkRSRUcubmFtZSwgRWxlbWVudFR5cGVzLkRSRUcudHlwZSk7XG4gICAgICAgIHRoaXMucFRPVEFMX0NIQU5DRSA9IDEwMDtcbiAgICAgICAgdGhpcy5wRFJFR19DUkVBVEUgPSAwLjE7XG4gICAgICAgIHRoaXMucFJFU19DUkVBVEUgPSAwLjU7XG4gICAgICAgIHRoaXMucERSRUdfREVTVFJPWSA9IDEwO1xuICAgICAgICB0aGlzLnBBTllfREVTVFJPWSA9IDE7XG4gICAgfVxuICAgIGV4ZWMoZXcpIHtcbiAgICAgICAgLy9nZXQgYSByYW5kb20gTkVTVyBzaXRlXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZVNpdGUgPSBldy5nZXRBZGphY2VudDRXYXkoKTtcbiAgICAgICAgLy9DUkVBVElPTlxuICAgICAgICBpZiAoYXZhaWxhYmxlU2l0ZS5hdG9tLnR5cGUgPT09IEVsZW1lbnRUeXBlcy5FTVBUWSkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlRFJlZyA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLnBUT1RBTF9DSEFOQ0UgPCB0aGlzLnBEUkVHX0NSRUFURTtcbiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZVJlcyA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLnBUT1RBTF9DSEFOQ0UgPCB0aGlzLnBSRVNfQ1JFQVRFO1xuICAgICAgICAgICAgaWYgKGNyZWF0ZURSZWcpIHtcbiAgICAgICAgICAgICAgICBldy5vcmlnaW4ubW92ZUF0b20oYXZhaWxhYmxlU2l0ZSwgbmV3IEF0b20oRWxlbWVudFR5cGVzLkRSRUcpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRSRUcgQ1JFQVRFRFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNyZWF0ZVJlcykge1xuICAgICAgICAgICAgICAgIGV3Lm9yaWdpbi5tb3ZlQXRvbShhdmFpbGFibGVTaXRlLCBuZXcgQXRvbShFbGVtZW50VHlwZXMuUkVTKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSRVMgQ1JFQVRFRFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGV3Lm9yaWdpbi5zd2FwQXRvbXMoYXZhaWxhYmxlU2l0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYXZhaWxhYmxlU2l0ZS5hdG9tLnR5cGUgPT09IEVsZW1lbnRUeXBlcy5EUkVHKSB7XG4gICAgICAgICAgICBjb25zdCBkZXN0cm95RFJlZyA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLnBUT1RBTF9DSEFOQ0UgPCB0aGlzLnBEUkVHX0RFU1RST1k7XG4gICAgICAgICAgICBpZiAoZGVzdHJveURSZWcpIHtcbiAgICAgICAgICAgICAgICAvL2V3Lm9yaWdpbi5raWxsQXRvbShhdmFpbGFibGVTaXRlKTtcbiAgICAgICAgICAgICAgICAvL2F2YWlsYWJsZVNpdGUuYXRvbSA9IG5ldyBBdG9tKEVsZW1lbnRUeXBlcy5FTVBUWSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJEUkVHIERFU1RST1lFRFwiKTtcbiAgICAgICAgICAgICAgICBldy5vcmlnaW4ubW92ZUF0b20oYXZhaWxhYmxlU2l0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvL2l0J3Mgc29tZXRoaW5nIGVsc2VcbiAgICAgICAgICAgIGNvbnN0IGRlc3Ryb3lBbnkgPSBNYXRoLnJhbmRvbSgpICogdGhpcy5wVE9UQUxfQ0hBTkNFIDwgdGhpcy5wQU5ZX0RFU1RST1k7XG4gICAgICAgICAgICBpZiAoZGVzdHJveUFueSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGF2YWlsYWJsZVNpdGUuYXRvbS50eXBlLm5hbWUgKyBcIiBERVNUUk9ZRURcIik7XG4gICAgICAgICAgICAgICAgLy9hdmFpbGFibGVTaXRlLmF0b20gPSBuZXcgQXRvbShFbGVtZW50VHlwZXMuRU1QVFkpO1xuICAgICAgICAgICAgICAgIGV3Lm9yaWdpbi5tb3ZlQXRvbShhdmFpbGFibGVTaXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdXBlci5leGVjKGV3KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBFbGVtIH0gZnJvbSBcIi4uL0VsZW1cIjtcbmltcG9ydCB7IEVsZW1lbnRUeXBlcyB9IGZyb20gXCIuLi9FbGVtZW50VHlwZXNcIjtcbmV4cG9ydCBjbGFzcyBSZXNFbGVtZW50IGV4dGVuZHMgRWxlbSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKEVsZW1lbnRUeXBlcy5SRVMubmFtZSwgRWxlbWVudFR5cGVzLlJFUy50eXBlKTtcbiAgICB9XG4gICAgZXhlYyhldykge1xuICAgICAgICBldy5vcmlnaW4uc3dhcEF0b21zKGV3LmdldFJhbmRvbShFbGVtZW50VHlwZXMuRU1QVFkpKTtcbiAgICAgICAgc3VwZXIuZXhlYyhldyk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgRWxlbSB9IGZyb20gXCIuLi9FbGVtXCI7XG5pbXBvcnQgeyBFbGVtZW50VHlwZXMgfSBmcm9tIFwiLi4vRWxlbWVudFR5cGVzXCI7XG5leHBvcnQgY2xhc3MgV2FsbEVsZW1lbnQgZXh0ZW5kcyBFbGVtIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoRWxlbWVudFR5cGVzLldBTEwubmFtZSwgRWxlbWVudFR5cGVzLldBTEwudHlwZSwgMCwgMCk7XG4gICAgfVxuICAgIGV4ZWMoZXcpIHtcbiAgICAgICAgc3VwZXIuZXhlYyhldyk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgTUZNVXRpbHMgfSBmcm9tIFwiLi4vdXRpbHMvdXRpbHNcIjtcbmltcG9ydCB7IEVsZW1lbnRUeXBlcyB9IGZyb20gXCIuL0VsZW1lbnRUeXBlc1wiO1xuLy9FdmVudCB3aW5kb3cgYXMgZGVzY3JpYmJlZCBoZXJlOiBodHRwOi8vcm9idXN0LmNzLnVubS5lZHUvbGliL2V4ZS9mZXRjaC5waHA/dz0zMDAmdG9rPTRjOGY0OSZtZWRpYT1kZXY6ZXZlbnQtd2luZG93LTEwLnBuZ1xuLy9Db2xsZWN0aW9uIG9mIHNpdGVzIHdoaWNoIGNvbnRhaW4gYXRvbXMsIGJ1aWx0IGZyb20gYW4gb3JpZ2luIChjZW50ZXIpIHNpdGVcbmV4cG9ydCBjbGFzcyBFdmVudFdpbmRvdyB7XG4gICAgY29uc3RydWN0b3IoX3RpbGUsIF9vcmlnaW4pIHtcbiAgICAgICAgdGhpcy50aWxlID0gX3RpbGU7XG4gICAgICAgIHRoaXMubWFrZVdpbmRvdyhfdGlsZSwgX29yaWdpbik7XG4gICAgfVxuICAgIG1ha2VXaW5kb3codGlsZSwgb3JpZ2luKSB7XG4gICAgICAgIHRoaXMud2luZG93ID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLm9yaWdpbiA9IHRoaXMudGlsZS5nZXRTaXRlQnlDb29yZChvcmlnaW4pO1xuICAgICAgICAvL2lmIHRoZSBvcmlnaW4gaXMgRU1QVFkgRWxlbWVudCwgbGV0J3Mgc2F2ZSBzb21lIGN5Y2xlcyAoZ29vZCwgYmFkPylcbiAgICAgICAgaWYgKHRoaXMub3JpZ2luLmF0b20udHlwZSA9PT0gRWxlbWVudFR5cGVzLkVNUFRZKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLndpbmRvdy5zZXQodGhpcy5vcmlnaW4uaWQsIHRoaXMub3JpZ2luKTtcbiAgICAgICAgbGV0IHdpbmRvd0FycmF5ID0gRXZlbnRXaW5kb3cuV0lORE9XX09SREVSX09GRlNFVFMubWFwKChvZmZzZXQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLk9mZnNldEZyb21PcmlnaW4ob3JpZ2luLCBvZmZzZXQucm93LCBvZmZzZXQuY29sKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvd0FycmF5LmZvckVhY2goKHRpbGVDb29yZCkgPT4ge1xuICAgICAgICAgICAgbGV0IHNpdGUgPSB0aWxlLmdldFNpdGVCeUNvb3JkKHRpbGVDb29yZCk7XG4gICAgICAgICAgICBpZiAoc2l0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMud2luZG93LnNldChzaXRlLmlkLCBzaXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIE9mZnNldEZyb21PcmlnaW4ob3JpZ2luLCByb3dPZmZzZXQsIGNvbE9mZnNldCkge1xuICAgICAgICByZXR1cm4geyByb3c6IG9yaWdpbi5yb3cgKyByb3dPZmZzZXQsIGNvbDogb3JpZ2luLmNvbCArIGNvbE9mZnNldCB9O1xuICAgIH1cbiAgICBnZXRSYW5kb20oc3BlY2lmaWNUeXBlID0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFNpdGVGcm9tQ2FuZGlkYXRlcyhBcnJheS5mcm9tKHRoaXMud2luZG93LnZhbHVlcygpKSwgdHJ1ZSwgc3BlY2lmaWNUeXBlKTtcbiAgICB9XG4gICAgZ2V0TmVhcmVzdChzcGVjaWZpY1R5cGUgPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2l0ZUZyb21DYW5kaWRhdGVzKEFycmF5LmZyb20odGhpcy53aW5kb3cudmFsdWVzKCkpLCBmYWxzZSwgc3BlY2lmaWNUeXBlKTtcbiAgICB9XG4gICAgZ2V0RWFzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGlyZWN0aW9uKEV2ZW50V2luZG93LkVXX0VBU1QpO1xuICAgIH1cbiAgICBnZXRXZXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXJlY3Rpb24oRXZlbnRXaW5kb3cuRVdfV0VTVCk7XG4gICAgfVxuICAgIGdldE5vcnRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXJlY3Rpb24oRXZlbnRXaW5kb3cuRVdfTk9SVEgpO1xuICAgIH1cbiAgICBnZXRTb3V0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGlyZWN0aW9uKEV2ZW50V2luZG93LkVXX1NPVVRIKTtcbiAgICB9XG4gICAgZ2V0Tm9ydGhXZXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXJlY3Rpb24oRXZlbnRXaW5kb3cuRVdfTk9SVEhXRVNUKTtcbiAgICB9XG4gICAgZ2V0U291dGhXZXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXJlY3Rpb24oRXZlbnRXaW5kb3cuRVdfU09VVEhXRVNUKTtcbiAgICB9XG4gICAgZ2V0Tm9ydGhFYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXJlY3Rpb24oRXZlbnRXaW5kb3cuRVdfTk9SVEhFQVNUKTtcbiAgICB9XG4gICAgZ2V0U291dGhFYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXJlY3Rpb24oRXZlbnRXaW5kb3cuRVdfU09VVEhFQVNUKTtcbiAgICB9XG4gICAgZ2V0QWRqYWNlbnQ0V2F5KHJhbmRvbWl6ZSA9IHRydWUsIHNwZWNpZmljVHlwZSA9IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaXRlRnJvbUNhbmRpZGF0ZXMoW3RoaXMuZ2V0V2VzdCgpLCB0aGlzLmdldE5vcnRoKCksIHRoaXMuZ2V0U291dGgoKSwgdGhpcy5nZXRFYXN0KCldLCByYW5kb21pemUsIHNwZWNpZmljVHlwZSk7XG4gICAgfVxuICAgIGdldEFkamFjZW50OFdheShyYW5kb21pemUgPSB0cnVlLCBzcGVjaWZpY1R5cGUgPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2l0ZUZyb21DYW5kaWRhdGVzKFtcbiAgICAgICAgICAgIHRoaXMuZ2V0V2VzdCgpLFxuICAgICAgICAgICAgdGhpcy5nZXROb3J0aCgpLFxuICAgICAgICAgICAgdGhpcy5nZXRTb3V0aCgpLFxuICAgICAgICAgICAgdGhpcy5nZXRFYXN0KCksXG4gICAgICAgICAgICB0aGlzLmdldE5vcnRoV2VzdCgpLFxuICAgICAgICAgICAgdGhpcy5nZXRTb3V0aFdlc3QoKSxcbiAgICAgICAgICAgIHRoaXMuZ2V0Tm9ydGhFYXN0KCksXG4gICAgICAgICAgICB0aGlzLmdldFNvdXRoRWFzdCgpXG4gICAgICAgIF0sIHJhbmRvbWl6ZSwgc3BlY2lmaWNUeXBlKTtcbiAgICB9XG4gICAgLy9HaXZlbiBhbiBhcnJheSBvZiBjYW5kaWRhdGUgc2l0ZXMgKHN5bW1ldHJpZXMgaW4gdGhlIGZ1dHVyZSBJIGhvcGUpLCBnaXZlIG1lIGJhY2sgb25lLCByYW5kb20gYnkgZGVmYXVsdCwgbm90IGZpbHRlcmVkIGJ5IHR5cGUgYnkgZGVmYXVsdFxuICAgIGdldFNpdGVGcm9tQ2FuZGlkYXRlcyhjYW5kaWRhdGVTaXRlcywgcmFuZG9taXplID0gdHJ1ZSwgc3BlY2lmaWNUeXBlID0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNhbmRpZGF0ZVNpdGVzID0gY2FuZGlkYXRlU2l0ZXMuZmlsdGVyKHNpdGUgPT4ge1xuICAgICAgICAgICAgaWYgKCFzaXRlKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghc3BlY2lmaWNUeXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNpdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzcGVjaWZpY1R5cGUgJiYgc2l0ZS5hdG9tLnR5cGUgPT09IHNwZWNpZmljVHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzaXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgLy9ubyBzaXRlcyEgeWlrZXMhIHBvc3NpYmxlIT8hIHByb2JhYmx5IG9ubHkgd2hlbiB1c2luZyBzcGVjaWZpY1R5cGUgYW5kIGxvb2tpbmcgZm9yIGEgcmFyZSBlbGVtZW50XG4gICAgICAgIGlmIChjYW5kaWRhdGVTaXRlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIC8vcmV0dXJuIHJhbmRvbVxuICAgICAgICBpZiAocmFuZG9taXplKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlU2l0ZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2FuZGlkYXRlU2l0ZXMubGVuZ3RoKV07XG4gICAgICAgIH1cbiAgICAgICAgLy9yZXR1cm4gZmlyc3QgbWF0Y2hpbmdcbiAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZVNpdGVzWzBdO1xuICAgIH1cbiAgICBnZXREaXJlY3Rpb24oZGlyZWN0aW9uKSB7XG4gICAgICAgIGxldCBzaXRlID0gdGhpcy50aWxlLnNpdGVzLmdldChNRk1VdGlscy5DdG9JRCh0aGlzLk9mZnNldEZyb21PcmlnaW4odGhpcy5vcmlnaW4udGlsZVBvcywgZGlyZWN0aW9uLnJvdywgZGlyZWN0aW9uLmNvbCkpKTtcbiAgICAgICAgaWYgKHNpdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBzaXRlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxufVxuRXZlbnRXaW5kb3cuV0lORE9XX09SREVSX09GRlNFVFMgPSBbXG4gICAgeyBjb2w6IDAsIHJvdzogMCB9LFxuICAgIHsgY29sOiAtMSwgcm93OiAwIH0sXG4gICAgeyBjb2w6IDAsIHJvdzogLTEgfSxcbiAgICB7IGNvbDogMCwgcm93OiAxIH0sXG4gICAgeyBjb2w6IDEsIHJvdzogMCB9LFxuICAgIHsgY29sOiAtMSwgcm93OiAtMSB9LFxuICAgIHsgY29sOiAtMSwgcm93OiAxIH0sXG4gICAgeyBjb2w6IDEsIHJvdzogLTEgfSxcbiAgICB7IGNvbDogMSwgcm93OiAxIH0sXG4gICAgeyBjb2w6IC0yLCByb3c6IDAgfSxcbiAgICB7IGNvbDogMCwgcm93OiAtMSB9LFxuICAgIHsgY29sOiAwLCByb3c6IDIgfSxcbiAgICB7IGNvbDogMiwgcm93OiAwIH0sXG4gICAgeyBjb2w6IC0yLCByb3c6IC0xIH0sXG4gICAgeyBjb2w6IC0yLCByb3c6IDEgfSxcbiAgICB7IGNvbDogLTEsIHJvdzogLTIgfSxcbiAgICB7IGNvbDogLTEsIHJvdzogMiB9LFxuICAgIHsgY29sOiAxLCByb3c6IC0yIH0sXG4gICAgeyBjb2w6IDEsIHJvdzogMiB9LFxuICAgIHsgY29sOiAyLCByb3c6IC0xIH0sXG4gICAgeyBjb2w6IDIsIHJvdzogMSB9LFxuICAgIHsgY29sOiAtMywgcm93OiAwIH0sXG4gICAgeyBjb2w6IDAsIHJvdzogLTMgfSxcbiAgICB7IGNvbDogMCwgcm93OiAzIH0sXG4gICAgeyBjb2w6IDMsIHJvdzogMCB9LFxuICAgIHsgY29sOiAtMiwgcm93OiAtMiB9LFxuICAgIHsgY29sOiAtMiwgcm93OiAyIH0sXG4gICAgeyBjb2w6IDIsIHJvdzogLTIgfSxcbiAgICB7IGNvbDogMiwgcm93OiAyIH0sXG4gICAgeyBjb2w6IC0zLCByb3c6IC0xIH0sXG4gICAgeyBjb2w6IC0zLCByb3c6IDEgfSxcbiAgICB7IGNvbDogLTEsIHJvdzogLTMgfSxcbiAgICB7IGNvbDogLTEsIHJvdzogMyB9LFxuICAgIHsgY29sOiAxLCByb3c6IC0zIH0sXG4gICAgeyBjb2w6IDEsIHJvdzogMyB9LFxuICAgIHsgY29sOiAzLCByb3c6IC0xIH0sXG4gICAgeyBjb2w6IDMsIHJvdzogMSB9LFxuICAgIHsgY29sOiAtNCwgcm93OiAwIH0sXG4gICAgeyBjb2w6IDAsIHJvdzogLTQgfSxcbiAgICB7IGNvbDogMCwgcm93OiA0IH0sXG4gICAgeyBjb2w6IDQsIHJvdzogMCB9XG5dO1xuLy9iZWNhdXNlLCBsYXp5XG5FdmVudFdpbmRvdy5FV19XRVNUID0geyBjb2w6IC0xLCByb3c6IDAgfTtcbkV2ZW50V2luZG93LkVXX0VBU1QgPSB7IGNvbDogMSwgcm93OiAwIH07XG5FdmVudFdpbmRvdy5FV19OT1JUSCA9IHsgY29sOiAwLCByb3c6IC0xIH07XG5FdmVudFdpbmRvdy5FV19TT1VUSCA9IHsgY29sOiAwLCByb3c6IDEgfTtcbkV2ZW50V2luZG93LkVXX05PUlRIV0VTVCA9IHsgY29sOiAtMSwgcm93OiAtMSB9O1xuRXZlbnRXaW5kb3cuRVdfU09VVEhXRVNUID0geyBjb2w6IC0xLCByb3c6IDEgfTtcbkV2ZW50V2luZG93LkVXX05PUlRIRUFTVCA9IHsgY29sOiAxLCByb3c6IC0xIH07XG5FdmVudFdpbmRvdy5FV19TT1VUSEVBU1QgPSB7IGNvbDogMSwgcm93OiAxIH07XG4iLCJpbXBvcnQgeyBFdmVudFdpbmRvdyB9IGZyb20gXCIuLi9jbGFzc2VzL0V2ZW50d2luZG93XCI7XG5leHBvcnQgY2xhc3MgTUZNVXRpbHMge1xuICAgIHN0YXRpYyBDdG9JRChjKSB7XG4gICAgICAgIHJldHVybiBgJHtjLnJvd306JHtjLmNvbH1gO1xuICAgIH1cbiAgICBzdGF0aWMgSUR0b0MoaWQpIHtcbiAgICAgICAgbGV0IHJjYSA9IGlkLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgcmV0dXJuIHsgcm93OiBwYXJzZUludChyY2FbMF0pLCBjb2w6IHBhcnNlSW50KHJjYVsxXSkgfTtcbiAgICB9XG4gICAgc3RhdGljIEdlbmVyYXRlRXZlbnRXaW5kb3codGlsZSwgdywgaCkge1xuICAgICAgICBsZXQgcmMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB3KTtcbiAgICAgICAgbGV0IHJyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaCk7XG4gICAgICAgIHJldHVybiBuZXcgRXZlbnRXaW5kb3codGlsZSwgeyByb3c6IHJyLCBjb2w6IHJjIH0pO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IE1GTVV0aWxzIH0gZnJvbSBcIi4uL3V0aWxzL3V0aWxzXCI7XG5pbXBvcnQgeyBBdG9tIH0gZnJvbSBcIi4vQXRvbVwiO1xuaW1wb3J0IHsgRWxlbWVudFR5cGVzIH0gZnJvbSBcIi4vRWxlbWVudFR5cGVzXCI7XG5leHBvcnQgY2xhc3MgU2l0ZSB7XG4gICAgY29uc3RydWN0b3IoX3Bvcykge1xuICAgICAgICB0aGlzLnRpbGVQb3MgPSBfcG9zO1xuICAgICAgICB0aGlzLmlkID0gTUZNVXRpbHMuQ3RvSUQodGhpcy50aWxlUG9zKTtcbiAgICAgICAgdGhpcy5jcmVhdGUoKTtcbiAgICB9XG4gICAgLy9pZiB0YXJnZXRTaXRlIGlzIGtpbGxhYmxlXG4gICAgLy9raWxsIGl0cyBhdG9tIChyZXBsYWNlIHdpdGggZW1wdHkpXG4gICAga2lsbEF0b20odGFyZ2V0U2l0ZSkge1xuICAgICAgICBsZXQga2lsbCA9IE1hdGgucmFuZG9tKCkgKiAxMDAgPCB0YXJnZXRTaXRlLmF0b20uZWxlbS5raWxsYWJpbGl0eTtcbiAgICAgICAgaWYgKGtpbGwpIHtcbiAgICAgICAgICAgIHRhcmdldFNpdGUuYXRvbSA9IG5ldyBBdG9tKEVsZW1lbnRUeXBlcy5FTVBUWSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9pZiB0YXJnZXQgc2l0ZSBpcyBraWxsYWJsZVxuICAgIC8vbW92ZSB0aGlzIGF0b20gdG8gdGFyZ2V0U2l0ZSwgYW5kIGxlYXZlIGJlaGluZCBsZWF2aW5nQXRvbSwgd2hpY2ggYnkgZGVmYXVsdCBpcyBlbXB0eVxuICAgIG1vdmVBdG9tKHRhcmdldFNpdGUsIGxlYXZpbmdBdG9tID0gbmV3IEF0b20oRWxlbWVudFR5cGVzLkVNUFRZKSkge1xuICAgICAgICBpZiAodGFyZ2V0U2l0ZSkge1xuICAgICAgICAgICAgbGV0IGtpbGwgPSBNYXRoLnJhbmRvbSgpICogMTAwIDwgdGFyZ2V0U2l0ZS5hdG9tLmVsZW0ua2lsbGFiaWxpdHk7XG4gICAgICAgICAgICBpZiAoa2lsbCkge1xuICAgICAgICAgICAgICAgIFt0aGlzLmF0b20sIHRhcmdldFNpdGUuYXRvbV0gPSBbbGVhdmluZ0F0b20sIHRoaXMuYXRvbV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9pZiB0YXJnZXRTaXRlIGlzIG1vdmVhYmxlXG4gICAgLy9zd2FwIGF0b21zIHdpdGggdGhpcyBvbmVcbiAgICBzd2FwQXRvbXModGFyZ2V0U2l0ZSkge1xuICAgICAgICBpZiAodGFyZ2V0U2l0ZSkge1xuICAgICAgICAgICAgbGV0IG1vdmUgPSBNYXRoLnJhbmRvbSgpICogMTAwIDwgdGFyZ2V0U2l0ZS5hdG9tLmVsZW0ubW92ZWFiaWxpdHk7XG4gICAgICAgICAgICBpZiAobW92ZSkge1xuICAgICAgICAgICAgICAgIFt0aGlzLmF0b20sIHRhcmdldFNpdGUuYXRvbV0gPSBbdGFyZ2V0U2l0ZS5hdG9tLCB0aGlzLmF0b21dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNyZWF0ZSgpIHtcbiAgICAgICAgdGhpcy5hdG9tID0gbmV3IEF0b20oKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBUaWxlIH0gZnJvbSBcIi4vbWZtL2NsYXNzZXMvVGlsZVwiO1xuaW1wb3J0IHsgRWxlbWVudFR5cGVzIH0gZnJvbSBcIi4vbWZtL2NsYXNzZXMvRWxlbWVudFR5cGVzXCI7XG5pbXBvcnQgeyBNRk1VdGlscyB9IGZyb20gXCIuL21mbS91dGlscy91dGlsc1wiO1xuaW1wb3J0IHsgQXRvbSB9IGZyb20gXCIuL21mbS9jbGFzc2VzL0F0b21cIjtcbmxldCBnID0gbmV3IFRpbGUoMzIsIDMyKTtcbnZhciBza2V0Y2ggPSAocCkgPT4ge1xuICAgIGxldCBzaXRlU2l6ZSA9IDE0O1xuICAgIGxldCBncmlkT2Zmc2V0ID0gMjU7XG4gICAgcC5wcmVsb2FkID0gKCkgPT4geyB9O1xuICAgIHAuc2V0dXAgPSAoKSA9PiB7XG4gICAgICAgIHAuY3JlYXRlQ2FudmFzKDcwMCwgNzAwKTtcbiAgICB9O1xuICAgIC8vICAgcC53aW5kb3dSZXNpemVkID0gKCkgPT4ge1xuICAgIC8vICAgICBwLnJlc2l6ZUNhbnZhcyhwLndpbmRvd1dpZHRoIC0gNTAsIHAud2luZG93SGVpZ2h0IC0gNTApO1xuICAgIC8vICAgfTtcbiAgICBsZXQgZHJhd0dyaWQgPSAocCwgdCkgPT4ge1xuICAgICAgICBwLnB1c2goKTtcbiAgICAgICAgcC50cmFuc2xhdGUoZ3JpZE9mZnNldCwgZ3JpZE9mZnNldCk7XG4gICAgICAgIHQuc2l0ZXMuZm9yRWFjaCgoc2l0ZSkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChzaXRlLmF0b20uZWxlbS50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBFbGVtZW50VHlwZXMuRU1QVFkudHlwZTpcbiAgICAgICAgICAgICAgICAgICAgcC5zdHJva2UoMCwgMCwgMCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHAuZmlsbCgzMiwgMzIsIDMyLCAxMjcpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVsZW1lbnRUeXBlcy5EUkVHLnR5cGU6XG4gICAgICAgICAgICAgICAgICAgIHAuc3Ryb2tlKDAsIDAsIDAsIDEyNyk7XG4gICAgICAgICAgICAgICAgICAgIHAuZmlsbCgyNTUsIDMyLCAzMik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgRWxlbWVudFR5cGVzLlJFUy50eXBlOlxuICAgICAgICAgICAgICAgICAgICBwLnN0cm9rZSgwLCAwLCAwLCAxMjcpO1xuICAgICAgICAgICAgICAgICAgICBwLmZpbGwoMzIsIDI1NSwgNjQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVsZW1lbnRUeXBlcy5XQUxMLnR5cGU6XG4gICAgICAgICAgICAgICAgICAgIHAuc3Ryb2tlKDAsIDAsIDAsIDEyNyk7XG4gICAgICAgICAgICAgICAgICAgIHAuZmlsbCgzMiwgMzIsIDI1NSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcC5lbGxpcHNlKHNpdGUudGlsZVBvcy5jb2wgKiBzaXRlU2l6ZSwgc2l0ZS50aWxlUG9zLnJvdyAqIHNpdGVTaXplLCBzaXRlU2l6ZSwgc2l0ZVNpemUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcC5wb3AoKTtcbiAgICB9O1xuICAgIGxldCBydW4gPSAoKSA9PiB7XG4gICAgICAgIGxldCBzcGVlZCA9IDEwMDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlZWQ7IGkrKykge1xuICAgICAgICAgICAgbGV0IGV3ID0gTUZNVXRpbHMuR2VuZXJhdGVFdmVudFdpbmRvdyhnLCBnLndpZHRoLCBnLmhlaWdodCk7XG4gICAgICAgICAgICBldy5vcmlnaW4uYXRvbS5leGVjKGV3KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgbGV0IGdldFNpdGVGcm9tQ2FudmFzWFkgPSAoeCwgeSkgPT4ge1xuICAgICAgICB4ID0geCAtIGdyaWRPZmZzZXQgKyBzaXRlU2l6ZSAqIDAuNTtcbiAgICAgICAgeSA9IHkgLSBncmlkT2Zmc2V0ICsgc2l0ZVNpemUgKiAwLjU7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKHggLyBzaXRlU2l6ZSk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKHkgLyBzaXRlU2l6ZSk7XG4gICAgICAgIHJldHVybiBnLmdldFNpdGVCeUNvb3JkKHsgcm93OiB5LCBjb2w6IHggfSk7XG4gICAgfTtcbiAgICBwLmRyYXcgPSAoKSA9PiB7XG4gICAgICAgIHAuYmFja2dyb3VuZCgxMDApO1xuICAgICAgICBkcmF3R3JpZChwLCBnKTtcbiAgICAgICAgcnVuKCk7XG4gICAgfTtcbiAgICBwLm1vdXNlQ2xpY2tlZCA9ICgpID0+IHtcbiAgICAgICAgbGV0IHNpdGUgPSBnZXRTaXRlRnJvbUNhbnZhc1hZKHAubW91c2VYLCBwLm1vdXNlWSk7XG4gICAgICAgIGlmIChzaXRlKSB7XG4gICAgICAgICAgICBpZiAocC5rZXlJc1ByZXNzZWQpIHtcbiAgICAgICAgICAgICAgICBzaXRlLmF0b20gPSBuZXcgQXRvbShFbGVtZW50VHlwZXMuV0FMTCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaXRlLmF0b20gPSBuZXcgQXRvbShFbGVtZW50VHlwZXMuRFJFRyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufTtcbmxldCBza2V0Y2hQID0gbmV3IHA1KHNrZXRjaCk7XG4iLCJpbXBvcnQgeyBTaXRlIH0gZnJvbSBcIi4vU2l0ZVwiO1xuaW1wb3J0IHsgTUZNVXRpbHMgfSBmcm9tIFwiLi4vdXRpbHMvdXRpbHNcIjtcbmV4cG9ydCBjbGFzcyBUaWxlIHtcbiAgICBjb25zdHJ1Y3Rvcihfd2lkdGggPSAxLCBfaGVpZ2h0ID0gMSkge1xuICAgICAgICB0aGlzLndpZHRoID0gX3dpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IF9oZWlnaHQ7XG4gICAgICAgIHRoaXMuY3JlYXRlKCk7XG4gICAgfVxuICAgIGdldFNpdGVCeUNvb3JkKGMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2l0ZXMuZ2V0KE1GTVV0aWxzLkN0b0lEKGMpKTtcbiAgICB9XG4gICAgZ2V0UmFuZG9tU2l0ZSgpIHtcbiAgICAgICAgbGV0IHJyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5oZWlnaHQpO1xuICAgICAgICBsZXQgcmMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLndpZHRoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2l0ZXMuZ2V0KGAke3JyfToke3JjfWApO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIHRoaXMuc2l0ZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy53aWR0aDsgaSsrKSB7XG4gICAgICAgICAgICAvL2Fjcm9zcyBjb2x1bW5zXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuaGVpZ2h0OyBqKyspIHtcbiAgICAgICAgICAgICAgICAvL2Rvd24gcm93c1xuICAgICAgICAgICAgICAgIHRoaXMuc2l0ZXMuc2V0KGAke2p9OiR7aX1gLCBuZXcgU2l0ZSh7IHJvdzogaiwgY29sOiBpIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=